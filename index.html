<!doctype html><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content=ylxdzsw@gmail.com><meta charset=utf-8><title>集齐一套 | ylxdzsw's blog</title><style>html{font-family:sans-serif;font-size:16px;line-height:1.5;text-align:justify;hyphens:auto;color:#33333d}@media (max-width:425px){html{font-size:15px}}body{max-width:625px;margin:0 auto;padding:1rem 1rem}@media (max-width:425px){body{padding:0 .8rem}}h3{margin:2rem 0 1rem;position:relative;border-bottom:#bbb 1px solid}label{display:block;font-weight:500;font-size:.9rem}label input:not([type]),label input[type=number],label input[type=text]{display:block;width:100%;margin:.1rem 0 1rem;padding:.4rem;border:1px solid #bbb;border-radius:3px;font-size:.9rem;box-sizing:border-box}label input[type=checkbox]{margin:.1rem .5rem 1rem 0;transform:translateY(.1rem)}button{display:inline-block;appearance:none;background-color:transparent;border:1px solid #bbb;border-radius:.375rem;cursor:pointer;line-height:100%;padding:.6rem .8rem}button:active{border-color:#4a4a4a;outline:0}button:focus{border-color:#485fc7;outline:0}button:hover{border-color:#b5b5b5}button:focus:not(:active){box-shadow:rgba(72,95,199,.25) 0 0 0 .125rem}pre{clear:both;margin-top:1rem;font-family:monospace;color:#222;border:1px solid #bcd;background-color:#ebf1f5;padding:.8rem;overflow-x:auto;font-size:.8rem}.hidden{opacity:0}</style><script>window.addEventListener("load",(async()=>{document.querySelector("button").addEventListener("click",(async()=>{document.querySelector("pre").classList.remove("hidden"),document.querySelector("button").disabled=!0,await new Promise((e=>setTimeout(e,0)));const e=Object.create(null);for(const t of document.querySelectorAll("input"))switch(t.type){case"text":e[t.name]=t.value;break;case"number":e[t.name]=parseFloat(t.value);break;case"checkbox":e[t.name]=t.checked}try{const t=await run(e);t&&(document.querySelector("pre").textContent=t)}catch(e){throw document.querySelector("pre").textContent="Error.",e}finally{document.querySelector("button").disabled=!1,await new Promise((e=>setTimeout(e,0)))}}))}))</script><h3>集齐一套</h3><label>英文逗号分隔每样物品掉率，例如1%就填0.01，可以写整数除法例如1/70。<input name=droprates placeholder=0.01,1/200,0.02></label><label>每样物品需求量。选填，默认全为1。<input name=demands placeholder=1,1,1></label> <label><input type=checkbox name=multidrop>单次抽卡可以同时出多样物品</label><script>let progress_bar=null;async function run(args){const droprates=eval("["+args.droprates+"]").map(Number),demands=eval("["+args.demands+"]").map(Number),max_pull=args.multidrop?1e6:1e5,log_interval=args.multidrop?5e3:1e3;for(const e of droprates)if(isNaN(e)||e<=0||e>1)throw"Invalid droprate";if(0==droprates.length)throw"No droprates";for(const e of demands)if(!Number.isInteger(e)||e<0)throw"Invalid demand";if(0==demands.length)for(;demands.length<droprates.length;)demands.push(1);else if(demands.length!=droprates.length)throw"Mismatched droprates and demands";if(!args.multidrop&&droprates.reduce(((e,r)=>e+r),0)>1)throw"Total droprate exceeds 100%";const probability=args.multidrop?multi_drop_probability:single_drop_probability,cache=args.multidrop?[]:{},check_points=[.5,.75,.9,.95,.99,.999,.9999],check_point_probabilities=check_points.map((e=>0));let next_check_point=0;for(let e=1;e<=max_pull;e++){const r=probability(e,droprates,demands,cache);if(e%log_interval==0&&(progress_bar||(progress_bar=document.createElement("progress"),progress_bar.max=1,document.body.insertBefore(progress_bar,document.querySelector("pre"))),progress_bar.value=Math.max(r,e/max_pull),await new Promise((e=>setTimeout(e,0)))),!(r<check_points[next_check_point])&&(check_point_probabilities[next_check_point]=e,next_check_point+=1,next_check_point>=check_points.length))break}let result="集齐概率\t抽卡次数\n";for(let e=0;e<check_points.length;e++)result+=check_points[e]+"\t"+(e<next_check_point?check_point_probabilities[e]:`>${max_pull}`)+"\n";return progress_bar&&progress_bar.remove(),progress_bar=null,result}function single_drop_probability(e,r,t,o){if(t.every((e=>e<=0)))return 1;if(e<=0)return 0;const n=e+","+t.join(",");if(n in o)return o[n];let i=0,s=0;for(let n=0;n<r.length;n++){if(t[n]<=0)continue;const a=t.slice();a[n]-=1,s+=r[n]*single_drop_probability(e-1,r,a,o),i+=r[n]}return s+=(1-i)*single_drop_probability(e-1,r,t,o),o[n]=s}function multi_drop_probability(e,r,t,o){function n(e,r,t,o){if(r<=0)return 1;if(e<=0)return 0;const i=e+","+r;return i in o?o[i]:o[i]=t*n(e-1,r-1,t,o)+(1-t)*n(e-1,r,t,o)}for(;o.length<r.length;)o.push({});let i=1;for(let s=0;s<r.length;s++)i*=n(e,t[s],r[s],o[s]);return i}"undefined"!=typeof Deno&&run({}).then(console.log)</script><button>Run</button><pre class=hidden></pre>